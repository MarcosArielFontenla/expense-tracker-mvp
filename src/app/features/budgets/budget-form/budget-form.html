<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
            {{ isEditMode ? 'Editar Presupuesto' : 'Nuevo Presupuesto' }}
        </h1>
        <p class="mt-1 text-sm text-gray-600">
            {{ isEditMode ? 'Modifica los límites de gasto' : 'Define un límite de gasto para una categoría' }}
        </p>
    </div>

    <!-- Error Alert -->
    <div *ngIf="error" class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4 animate-slide-in">
        <p class="text-red-800">{{ error }}</p>
    </div>

    <!-- Form -->
    <form [formGroup]="budgetForm" (ngSubmit)="onSubmit()"
        class="space-y-6 bg-white p-6 rounded-lg shadow-sm border border-gray-200">

        <!-- Category -->
        <div>
            <label for="categoryId" class="label">Categoría *</label>
            <select id="categoryId" formControlName="categoryId" class="input-field"
                [class.border-red-500]="categoryId?.invalid && categoryId?.touched">
                <option value="" disabled>Selecciona una categoría</option>
                <option *ngFor="let cat of categories" [value]="cat.id">
                    {{ cat.icon }} {{ cat.name }}
                </option>
            </select>
            <div *ngIf="categoryId?.invalid && categoryId?.touched" class="mt-1 text-sm text-red-600">
                <p *ngIf="categoryId?.errors?.['required']">La categoría es obligatoria</p>
            </div>
            <p *ngIf="categories.length === 0" class="mt-2 text-sm text-yellow-600">
                ⚠️ No hay categorías de gasto.
                <a routerLink="/categories/new" class="underline font-medium">Crear una</a>
            </p>
        </div>

        <!-- Amount -->
        <div>
            <label for="amount" class="label">Límite de Gasto *</label>
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <span class="text-gray-500 sm:text-sm">$</span>
                </div>
                <input id="amount" type="number" formControlName="amount" class="input-field pl-7"
                    [class.border-red-500]="amount?.invalid && amount?.touched" placeholder="0.00" step="0.01" />
            </div>
            <div *ngIf="amount?.invalid && amount?.touched" class="mt-1 text-sm text-red-600">
                <p *ngIf="amount?.errors?.['required']">El monto es obligatorio</p>
                <p *ngIf="amount?.errors?.['min']">El monto debe ser mayor a 0</p>
            </div>
        </div>

        <!-- Period Row -->
        <div class="grid grid-cols-2 gap-6">
            <!-- Month -->
            <div>
                <label for="month" class="label">Mes *</label>
                <select id="month" formControlName="month" class="input-field">
                    <option *ngFor="let m of months" [value]="m.value">{{ m.label }}</option>
                </select>
            </div>

            <!-- Year -->
            <div>
                <label for="year" class="label">Año *</label>
                <select id="year" formControlName="year" class="input-field">
                    <option *ngFor="let y of years" [value]="y">{{ y }}</option>
                </select>
            </div>
        </div>

        <!-- Alert Threshold -->
        <div>
            <label for="alertThreshold" class="label flex justify-between">
                <span>Alerta al llegar al %</span>
                <span class="font-bold text-primary-600">{{ alertThreshold?.value }}%</span>
            </label>
            <input id="alertThreshold" type="range" formControlName="alertThreshold" min="1" max="100"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary-600" />
            <p class="mt-1 text-xs text-gray-500">
                Se mostrará una alerta visual cuando el gasto supere este porcentaje.
            </p>
        </div>

        <!-- Actions -->
        <div class="flex gap-4 pt-4 border-t border-gray-100">
            <button type="button" (click)="onCancel()" class="btn btn-secondary flex-1" [disabled]="isSubmitting">
                Cancelar
            </button>
            <button type="submit" class="btn btn-primary flex-1" [disabled]="budgetForm.invalid || isSubmitting">
                <span *ngIf="!isSubmitting">{{ isEditMode ? 'Guardar Cambios' : 'Crear Presupuesto' }}</span>
                <span *ngIf="isSubmitting" class="flex items-center justify-center gap-2">
                    <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                    Guardando...
                </span>
            </button>
        </div>
    </form>
</div>